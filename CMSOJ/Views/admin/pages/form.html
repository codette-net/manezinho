{% extends CMSOJ/Views/admin/main.html %}

{% block title %} <?= htmlspecialchars($title ?? 'Page', ENT_QUOTES, 'UTF-8') ?> {% endblock %}

{% block page %}
<header class="content-header">
  <div>
    <h2><?= htmlspecialchars($title ?? 'Page', ENT_QUOTES, 'UTF-8') ?></h2>
    <p><?= !empty($editing) ? 'Update the page details.' : 'Create a new page.' ?></p>
  </div>

  <div class="actions">
    <a href="/admin/pages" class="btn">Cancel</a>
  </div>
</header>

<?php if (!empty($flash['error'])): ?>
  <div class="msg error" role="alert"><?= htmlspecialchars($flash['error'], ENT_QUOTES, 'UTF-8') ?></div>
<?php endif; ?>

<form method="post" action="/admin/pages/save">
  <input type="hidden" name="_csrf" value="<?= htmlspecialchars($csrf, ENT_QUOTES, 'UTF-8') ?>">
  <input type="hidden" name="id" value="<?= (int)($page['id'] ?? 0) ?>">

  <div class="form-grid">
    <div class="col-span-2">
      <label for="title">Title <span class="required">*</span></label>
      <input id="title" name="title" required type="text"
        value="<?= htmlspecialchars($page['title'] ?? '', ENT_QUOTES, 'UTF-8') ?>">
    </div>

    <div class="col-span-2">
      <label for="slug">Slug</label>
      <p class="comment">Optional. If empty, it will be generated from the title.</p>
      <input id="slug" name="slug" type="text"
        value="<?= htmlspecialchars($page['slug'] ?? '', ENT_QUOTES, 'UTF-8') ?>"
        placeholder="my-page">
    </div>

    <div class="col-span-2">
      <label for="description">Description</label>
      <textarea id="description" name="description" rows="5"><?= htmlspecialchars($page['description'] ?? '', ENT_QUOTES, 'UTF-8') ?></textarea>
    </div>

    <div class="col-span-2">
      <label for="url">URL</label>
      <input id="url" name="url" type="text"
        value="<?= htmlspecialchars($page['url'] ?? '', ENT_QUOTES, 'UTF-8') ?>"
        placeholder="https://...">
    </div>

    <div>
      <label>
        <input type="checkbox" name="is_active" <?= !empty($page['is_active']) ? 'checked' : '' ?>>
        Active
      </label>
    </div>
  </div>

  <div class="actions" style="margin-top: 16px;">
    <button class="btn btn-primary" type="submit">Save</button>
  </div>
</form>

<?php if (!empty($editing) && !empty($page['id'])): ?>
  <form method="post" action="/admin/pages/delete/<?= (int)$page['id'] ?>"
        onsubmit="return confirm('Delete this page?');"
        style="margin-top: 10px;">
    <input type="hidden" name="_csrf" value="<?= htmlspecialchars($csrf, ENT_QUOTES, 'UTF-8') ?>">
    <button class="btn btn-danger" type="submit">Delete</button>
  </form>
<?php endif; ?>

{% endblock %}
