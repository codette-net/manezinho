{% extends CMSOJ/Views/admin/main.html %}

{% block title %} Pages {% endblock %}

{% block page %}
<header class="content-header">
  <div>
    <h2>Pages</h2>
    <p>Pages automatically appear when new events are created.</p>
  </div>
</header>

<?php if (!empty($flash['success'])): ?>
  <div class="msg success" role="status"><?= htmlspecialchars($flash['success'], ENT_QUOTES, 'UTF-8') ?></div>
<?php endif; ?>
<?php if (!empty($flash['error'])): ?>
  <div class="msg error" role="alert"><?= htmlspecialchars($flash['error'], ENT_QUOTES, 'UTF-8') ?></div>
<?php endif; ?>

<form method="get" action="/admin/pages" class="filters">
  <div class="filters-grid">
    <div>
      <label for="search_query">Search</label>
      <input id="search_query" type="text" name="search_query"
        value="<?= htmlspecialchars($query['search_query'] ?? '', ENT_QUOTES, 'UTF-8') ?>"
        placeholder="Search page...">
    </div>
  </div>

  <input type="hidden" name="sort" value="<?= htmlspecialchars($query['sort'] ?? 'uid', ENT_QUOTES, 'UTF-8') ?>">
  <input type="hidden" name="dir" value="<?= htmlspecialchars($query['dir'] ?? 'asc', ENT_QUOTES, 'UTF-8') ?>">

  <div class="filters-actions">
    <button type="submit" class="btn btn-primary">Apply</button>
    <a href="/admin/events/pages" class="btn">Reset</a>
  </div>
</form>

{% component 'admin/table', [
  'headers'  => $headers,
  'rows'     => $rows,
  'sortable' => $sortable,
  'query'    => $query,
  'bulk'     => $bulk
] %}

<?php
  $page  = (int)($meta['page'] ?? 1);
  $pages = (int)($meta['pages'] ?? 1);
  $baseQuery = $query;
?>

<nav class="pagination" aria-label="Pagination">
  <span>Page <?= $page ?> of <?= $pages ?></span>
  <div class="actions">
    <?php if ($page > 1): ?>
      <?php $baseQuery['page'] = $page - 1; ?>
      <a class="btn" href="?<?= http_build_query($baseQuery) ?>">Prev</a>
    <?php endif; ?>
    <?php if ($page < $pages): ?>
      <?php $baseQuery['page'] = $page + 1; ?>
      <a class="btn" href="?<?= http_build_query($baseQuery) ?>">Next</a>
    <?php endif; ?>
  </div>
</nav>
{% endblock %}
