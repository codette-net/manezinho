{% extends CMSOJ/Views/layout.html %}

{% block title %} {{ $title }} {% endblock %}

{% block meta %}
@parent
  <meta name="description" content="Discover the authentic taste of São Jorge at Art Restaurant Manezinho. Enjoy fresh seafood, local meats, São Jorge cheese, and curated wines in a relaxed setting.">
  <meta name="keywords" content="Art Restaurant Manezinho, São Jorge cuisine, Azorean food, fresh seafood, local meats, São Jorge cheese, tapas, Azorean wines, craft cocktails, Urzelina restaurant">
{% endblock %}


{% block css %}
@parent
<link rel="stylesheet" href="/assets/css/menu.css">
{% endblock %}


{% block content %}

{% partial 'nav' %}
<main>

  <header class="header-alt">
    <h1 class="hero-header">Art Restaurant Manezinho</h1>
    <h2 class="hero-header-h2">Menu</h2>

    <div class="lang-switch">
      <a href="?lang=en" class="<?= $lang === 'en' ? 'active' : '' ?>">English</a>
      <a href="?lang=pt" class="<?= $lang === 'pt' ? 'active' : '' ?>">Português</a>
    </div>
    <div class="sub-menu-nav">
      <ul>
      <?php foreach ($tree as $main): ?>
      <li>
        <a href="/menu#<?= htmlspecialchars($main["name_$lang"] ?: $main["name_en"])?>">
          <?= htmlspecialchars($main["name_$lang"] ?: $main["name_en"])?>
        </a>
      </li>
      <?php endforeach; ?>
      </ul>

    </div>
  </header>



  <?php foreach ($tree as $main): ?>
  <section class="menu-section">
    <h2 id="<?= htmlspecialchars($main["name_$lang"] ?: $main["name_en"])?>">
      <?= htmlspecialchars($main["name_$lang"] ?: $main["name_en"]) ?>
    </h2>

    <?php if ($main["description_$lang"]): ?>
    <p>
      <?= nl2br(htmlspecialchars($main["description_$lang"])) ?>
    </p>
    <?php endif; ?>

    <?php if (!empty($main['children'])): ?>
    <?php foreach ($main['children'] as $sub): ?>
    <article class="menu-subsection">
      <h3>
        <?= htmlspecialchars($sub["name_$lang"] ?: $sub["name_en"]) ?>
      </h3>
      <?php if ($sub["description_$lang"]): ?>
      <p>
        <?= nl2br(htmlspecialchars($sub["description_$lang"])) ?>
      </p>
      <?php endif; ?>
      {% component 'menu-table', [
      'id' => $sub['id'],
      'items' => $itemsBySection,
      'lang' => $lang
      ] %}


    </article>
    <?php endforeach; ?>
    <?php else: ?>
    {% component 'menu-table', ['id' => $main['id'], 'items' => $itemsBySection, 'lang' => $lang] %}

    <?php endif; ?>

  </section>
  <?php endforeach; ?>

  </div>

  {% partial 'reservation' %}

</main>

{% endblock %}

{% partial 'footer' %}

{% block scripts %}
@parent

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Menu",
  "name": "Art Restaurant Manezinho Menu",
  "url": "https://www.artrestaurantmanezinho.com/menu",
  "hasMenuSection": [
    <?php $firstSection = true; ?>
    <?php foreach ($tree as $main): ?>
    <?php if (!$firstSection) echo ','; $firstSection = false; ?>
    {
      "@type": "MenuSection",
      "name": "<?= htmlspecialchars($main["name_en"] ?: ''); ?>",
      "description": "<?= htmlspecialchars($main["description_en"] ?: ''); ?>",
      "hasMenuItem": [
        <?php
          $sectionItems = $itemsBySection[$main['id']] ?? [];
          $firstItem = true;
          foreach ($sectionItems as $it):
            if (!$firstItem) echo ','; $firstItem = false;
        ?>
        {
          "@type": "MenuItem",
          "name": "<?= htmlspecialchars($it['name_en'] ?: ''); ?>",
          "description": "<?= htmlspecialchars($it['description_en'] ?: ''); ?>",
          "offers": {
            "@type": "Offer",
            "price": "<?= htmlspecialchars($it['price_1'] ?: '0.00'); ?>",
            "priceCurrency": "EUR"
          }
        }
        <?php endforeach; ?>
      ]
    }
    <?php endforeach; ?>
  ]
}
</script>
{% endblock %}